name: Android CI - Memory Match Madness
 
on:

  push:

    branches: [ "master", "main", "develop" ]

  pull_request:

    branches: [ "master", "main", "develop" ]

  workflow_dispatch:
 
jobs:

  build:

    name: Build and Test

    runs-on: ubuntu-latest
 
    steps:

      - name: Checkout code

        uses: actions/checkout@v4
 
      - name: Set up JDK 17

        uses: actions/setup-java@v4

        with:

          distribution: 'temurin'

          java-version: '17'

          cache: 'gradle'
 
      - name: Grant execute permission for gradlew

        run: chmod +x ./gradlew
 
      - name: Cache Gradle packages

        uses: actions/cache@v3

        with:

          path: |

            ~/.gradle/caches

            ~/.gradle/wrapper

          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}

          restore-keys: |

            ${{ runner.os }}-gradle-
 
      - name: Build with Gradle

        run: ./gradlew build --stacktrace
 
      - name: Run unit tests

        run: ./gradlew testDebugUnitTest --stacktrace
 
      - name: Generate test report

        if: always()

        run: ./gradlew testDebugUnitTest
 
      - name: Upload test results

        if: always()

        uses: actions/upload-artifact@v3

        with:

          name: test-results

          path: app/build/reports/tests/testDebugUnitTest/
 
      - name: Upload build artifacts

        if: success()

        uses: actions/upload-artifact@v3

        with:

          name: app-debug

          path: app/build/outputs/apk/debug/*.apk
 
      - name: Test Report

        uses: dorny/test-reporter@v1

        if: always()

        with:

          name: Unit Test Results

          path: app/build/test-results/testDebugUnitTest/*.xml

          reporter: java-junit
 
